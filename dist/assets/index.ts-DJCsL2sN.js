(function(){class d{analyze(){return{interactiveElements:this.findInteractiveElements(),dataContainers:this.findDataContainers(),forms:this.findForms(),navigation:this.findNavigation(),timestamp:Date.now()}}findInteractiveElements(){const t=["button","a[href]","input","select","textarea",'[role="button"]',"[onclick]","[data-action]"],e=document.querySelectorAll(t.join(", "));return this.mapElements(Array.from(e).slice(0,50),!0)}findDataContainers(){const t=[],e=document.querySelectorAll('[class*="list"], [class*="grid"], [class*="card"], [class*="item"]');t.push(...Array.from(e).slice(0,20));const r=document.querySelectorAll("table");t.push(...Array.from(r).slice(0,5));const n=document.querySelectorAll("[data-id], [data-item], [data-content]");return t.push(...Array.from(n).slice(0,20)),this.mapElements(t,!1)}findForms(){const t=document.querySelectorAll("form");return this.mapElements(Array.from(t).slice(0,10),!1)}findNavigation(){const t=document.querySelectorAll('nav, [role="navigation"], header, [class*="nav"], [class*="menu"]');return this.mapElements(Array.from(t).slice(0,10),!1)}mapElements(t,e){return t.map(r=>this.mapElement(r,e)).filter(Boolean)}mapElement(t,e){try{const r=this.getUniqueSelector(t);if(!r)return null;const n=t;return{selector:r,tagName:t.tagName,id:t.id||void 0,classes:Array.from(t.classList).slice(0,5),textContent:e?this.getTextContent(n):void 0,attributes:this.getRelevantAttributes(t),isInteractive:this.isInteractive(t),boundData:this.detectBoundData(t)}}catch{return null}}getUniqueSelector(t){if(t.id)return`#${CSS.escape(t.id)}`;const e=t.getAttribute("data-testid")||t.getAttribute("data-test");if(e)return`[data-testid="${CSS.escape(e)}"]`;const r=[];let n=t;for(;n&&n!==document.body&&r.length<5;){let a=n.tagName.toLowerCase();if(n.id){a=`#${CSS.escape(n.id)}`,r.unshift(a);break}if(n.classList.length>0){const i=Array.from(n.classList).find(o=>!o.match(/^(active|open|show|hide|visible|hidden|disabled|enabled)$/));i&&(a+=`.${CSS.escape(i)}`)}const l=n.parentElement;if(l){const i=Array.from(l.children).filter(o=>o.tagName===n.tagName);if(i.length>1){const o=i.indexOf(n)+1;a+=`:nth-child(${o})`}}r.unshift(a),n=n.parentElement}return r.join(" > ")}getTextContent(t){var r;const e=Array.from(t.childNodes).filter(n=>n.nodeType===Node.TEXT_NODE).map(n=>{var a;return(a=n.textContent)==null?void 0:a.trim()}).filter(Boolean).join(" ");if(e)return e.substring(0,100);if(["BUTTON","A","LABEL"].includes(t.tagName))return(r=t.innerText)==null?void 0:r.substring(0,100)}getRelevantAttributes(t){const e={},r=["href","src","type","name","value","placeholder","aria-label","role","data-action"];for(const n of r){const a=t.getAttribute(n);a&&(e[n]=a.substring(0,100))}return e}isInteractive(t){const e=t.tagName.toLowerCase();return!!(["button","a","input","select","textarea"].includes(e)||t.getAttribute("role")==="button"||t.hasAttribute("onclick")||t.hasAttribute("tabindex"))}detectBoundData(t){const e=Array.from(t.attributes).filter(a=>a.name.startsWith("data-")).map(a=>`${a.name}=${a.value}`).join(", ");if(e)return e;const r=t.getAttribute("ng-bind")||t.getAttribute("ng-model");if(r)return`angular:${r}`;const n=t.getAttribute("v-model");if(n)return`vue:${n}`}}const u=new d;chrome.runtime.onMessage.addListener((s,t,e)=>(m(s).then(e),!0));async function m(s){switch(s.type){case"ANALYZE_DOM":{const t=u.analyze(),e=window.location.hostname;return chrome.runtime.sendMessage({type:"DOM_ANALYSIS_RESULT",payload:{domain:e,analysis:t}}),t}case"INJECT_SCRIPT":{const{code:t}=s.payload;return f(t)}default:return{error:"Unknown message type"}}}function f(s){try{const t=document.createElement("script");return t.textContent=`
      (function() {
        try {
          ${s}
        } catch (e) {
          console.error('[Quark] Script error:', e);
        }
      })();
    `,document.documentElement.appendChild(t),t.remove(),{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:String(t)}}}function h(){document.readyState==="complete"?c():window.addEventListener("load",c)}function c(){setTimeout(()=>{const s=u.analyze(),t=window.location.hostname;chrome.runtime.sendMessage({type:"DOM_ANALYSIS_RESULT",payload:{domain:t,analysis:s}}).catch(()=>{})},1e3)}h();const g=new MutationObserver(s=>{s.some(e=>e.addedNodes.length>5||e.removedNodes.length>5||e.type==="childList"&&e.target.nodeName==="BODY")&&c()});g.observe(document.body,{childList:!0,subtree:!0});console.log("[Quark] Content script loaded");
})()
